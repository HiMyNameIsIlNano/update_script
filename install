#!/bin/sh

__read_property(){
	local input="$@"
	temp=`cat ${config_file} | sed 's/\"//g' | grep -w ${input} | cut -d ":" -f2`
	echo ${temp##*|}
}

default_dir=${HOME}/.local/scripts
config_file=${default_dir}/update.config

mkdir -p ${default_dir}

cp update ${default_dir}
chmod +x ${default_dir}/update_ports
cp update.config ${default_dir}

cp update_world ${default_dir}
chmod +x ${default_dir}/update_world
cp update_world.config ${default_dir}

cp update_pkg ${default_dir}
chmod +x ${default_dir}/update_pkg

cp update_wrapper ${default_dir}

update_ports_frequency_in_days=$(__read_property update_ports_frequency_in_days)
(crontab -l; echo "* * */${update_ports_frequency_in_days} * * ${HOME}/.local/scripts/update_wrapper -p >/dev/null 2>&1" ) | crontab -

update_world_frequency_in_days=$(__read_property update_world_frequency_in_days)
(crontab -l; echo "* * */${update_world_frequency_in_days} * * ${HOME}/.local/scripts/update_wrapper -w >/dev/null 2>&1" ) | crontab -

# Check the crontab file before ending the script
crontab -e

exit 0
